{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Query, Mutation } from 'react-apollo';\nimport Error from '../components/ErrorMessage';\nimport gql from 'graphql-tag';\nimport Table from './styles/Table';\nimport SickButton from './styles/SickButton';\nconst possiblePermissions = ['ADMIN', 'USER', 'PERMISSIONUPDATE'];\nconst UPDATE_PERMISSIONS_MUTATION = gql`\n  mutation updatePermissions($permissions: [Permission], $userId: ID!) {\n    updatePermissions(permissions: $permissions, userId: $userId) {\n      id\n      permissions\n      name\n      email\n    }\n  }\n`;\nconst ALL_USERS_QUERY = gql`\n  query {\n    users {\n      id\n      name\n      email\n      permissions\n    }\n  }\n`;\n\nconst Permissions = props => __jsx(Query, {\n  query: ALL_USERS_QUERY\n}, ({\n  data,\n  loading,\n  error\n}) => {\n  if (loading) return 'Loading...';\n  if (error) return __jsx(Error, {\n    error: error\n  });\n  return __jsx(\"div\", null, __jsx(\"div\", null, __jsx(\"h2\", null, \"Manage Permissions\"), __jsx(Table, null, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, \"Name\"), __jsx(\"th\", null, \"Email\"), possiblePermissions.map(permission => __jsx(\"th\", {\n    key: permission\n  }, permission)), __jsx(\"th\", null, \"\\uD83D\\uDC47\"))), __jsx(\"tbody\", null, data.users.map(user => __jsx(UserPermissions, {\n    key: user.id,\n    user: user\n  }))))));\n});\n\nclass UserPermissions extends React.Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      permissions: this.props.user.permissions\n    });\n\n    _defineProperty(this, \"handlePermissionChange\", (e, updatePermissions) => {\n      const checkbox = e.target; //take a copy of the current permissions\n\n      let updatedPermissions = [...this.state.permissions]; //figure out if we need to remove or add this permission\n\n      if (checkbox.checked) {\n        updatedPermissions.push(checkbox.value);\n      } else {\n        updatedPermissions = updatedPermissions.filter(permission => permission !== checkbox.value);\n      } //be aware that setState is async, you can use a callback function ala node.\n\n\n      this.setState({\n        permissions: updatedPermissions\n      }, updatePermissions);\n    });\n  }\n\n  render() {\n    const user = this.props.user;\n    return __jsx(Mutation, {\n      mutation: UPDATE_PERMISSIONS_MUTATION,\n      variables: {\n        permissions: this.state.permissions,\n        userId: user.id\n      }\n    }, (updatePermissions, {\n      loading,\n      error\n    }) => __jsx(React.Fragment, null, error && __jsx(\"tr\", null, __jsx(\"td\", {\n      colspan: \"8\"\n    }, __jsx(Error, {\n      error: error\n    }))), __jsx(\"tr\", null, __jsx(\"td\", null, user.name), __jsx(\"td\", null, user.email), possiblePermissions.map(p => __jsx(\"td\", {\n      key: p\n    }, __jsx(\"label\", {\n      htmlFor: `${user.id}-permission-${p}`\n    }, __jsx(\"input\", {\n      id: `${user.id}-permission-${p}`,\n      type: \"checkbox\",\n      checked: this.state.permissions.includes(p),\n      value: p,\n      onChange: e => {\n        this.handlePermissionChange(e, updatePermissions);\n      }\n    })))), __jsx(\"td\", null, __jsx(SickButton, {\n      type: \"button\",\n      disabled: loading,\n      onClick: updatePermissions\n    }, ' ', \"Updat\", loading ? 'ing' : 'e')))));\n  }\n\n}\n\nexport default Permissions;","map":null,"metadata":{},"sourceType":"module"}